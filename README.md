# majiangOCR
对立直麻将进行番数点数的计算

在构建一个麻将牌识别和计分系统中，图像处理、深度学习和规则引擎三个部分的工作各自承担不同的职责，它们协同作用，完成从图像到得分的全流程。以下是它们各自的作用和主要工作内容：
## 1. 图像处理（Image Processing）
主要工作：

对输入的麻将牌图像进行预处理，提升图像质量和 OCR 识别精度。
提供图像裁剪、旋转校正等操作，为后续的深度学习和规则判断做准备。

具体任务：

1. 图像预处理:
    - 灰度化: 将彩色图像转换为灰度图像，减少信息维度，去除不必要的颜色信息。
    - 二值化: 将图像中的像素点转化为纯黑或纯白，有助于去除背景干扰。
    - 去噪: 使用滤波器（如高斯模糊、均值滤波）去除图像中的噪点和杂质，提升识别效果。
2. 图像分割与检测:
    - 使用算法（如霍夫变换、轮廓检测）检测和分割出单张麻将牌的位置和形状。
    - 在复杂背景中提取出麻将牌的区域（ROI, Region of Interest）。
3.透视变换与校正:
    - 对拍摄角度有偏差的图像进行透视校正（Perspective Transformation），使麻将牌显示为正面。
    - 校正麻将牌的旋转角度，使其符合标准方向。
4. 字符切割与分割:
    - 对识别出的麻将牌进行字符切割，分割出具体的牌面符号（如筒、条、万等）。
图像处理的作用： 图像处理的目的是尽量将图像中杂乱的视觉信息转化为清晰的结构化数据，从而提高后续深度学习模型识别的准确性。

## 2. 深度学习（Deep Learning）
主要工作：

使用深度学习模型（如卷积神经网络、循环神经网络）对图像中的麻将牌面进行识别和分类，将图像中的视觉信息转化为具体的牌面内容（如“5筒”、“白板”）。

具体任务：

1. 牌面识别:
    - 使用卷积神经网络（CNN）对麻将牌图像进行分类，将牌面符号映射到预先定义的类别（如 ['1筒', '2筒', ..., '东风', '南风', '红中']）。
    - 结合 RNN（如 LSTM、GRU）和 CTC 损失来处理麻将牌的序列识别任务，特别是复杂的手牌排列。
2. 字符识别（OCR）:
    - 使用 OCR 模型（如 CRNN、Attention OCR）从麻将牌面图像中提取牌面字符或符号，识别出每一张牌的具体类型。
    - 如果需要识别手牌的顺序，还需要结合位置和关系信息来处理。
3. 模型微调:
    - 如果现有模型不能准确识别日本麻将牌，可以进行迁移学习（Transfer Learning）或微调（Fine-tuning），使用特定的数据集进行再训练，提高模型的准确性。
深度学习的作用： 深度学习的主要任务是将预处理后的图像转化为结构化的牌面数据，为后续的规则引擎做基础。它的核心是将图像信息映射到具体的麻将牌类别中。

## 3. 规则引擎（Rule Engine）
主要工作：

根据识别出的牌面信息，结合日本麻将的规则进行逻辑判断，包括牌型的识别、番种的计算、符数和点数的计算。

具体任务：

1. 牌型检测:
    - 检测是否存在特定的牌型组合（如平和、清一色、七对子等），以及这些牌型的匹配条件（如门清、一发等）。
    - 判断手牌是否符合胡牌条件（14 张牌组成 4 个顺子/刻子和一对）。
2. 番种计算:
    - 根据日本麻将的规则库，判断当前手牌的番种，包括立直、自摸、断幺九、一气通贯等。
    - 可以使用规则匹配算法（如 if-else 结构、正则表达式）或决策树来实现番种的判断。
3. 符数计算:
    - 符数是麻将计分的基础，根据手牌结构和胡牌方式（如荣和、自摸、暗刻等）计算出符数。
    - 符数计算需要考虑雀头的种类（役牌、场风等）、搭子的形式（顺子、刻子）和和牌形式。
4. 点数计算:
    - 依据番数和符数的组合，查表或公式计算最终的得分（如满贯、倍满等）。
    - 点数计算还需要考虑自摸、放铳等条件，输出最终的点数变化。
规则引擎的作用： 规则引擎是系统的核心逻辑部分，它将深度学习识别出的牌面信息转化为实际的游戏规则判断和分数计算。它使得系统不仅能够识别牌面，还能给出具体的得分和解释。

## 整体工作流程
- 图像处理: 对麻将局图像进行预处理和牌面分割，生成适合识别的图像。
- 深度学习: 使用预训练或微调后的 OCR 模型识别图像中的麻将牌内容，并输出结构化数据。
- 规则引擎: 依据识别结果进行规则匹配和计算，输出胡牌番种、符数和最终点数。
通过以上三个部分的协同工作，能够实现完整的麻将牌识别和计分系统。你可以根据具体需求，分别对这三个部分进行优化和调整。


